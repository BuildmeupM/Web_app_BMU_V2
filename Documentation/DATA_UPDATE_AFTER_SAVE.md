# ‚ö° ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å - Data Update After Save

## üìã ‡∏™‡∏£‡∏∏‡∏õ

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô

---

## ‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÄ‡∏î‡∏¥‡∏°)

**‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:** 0-30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö staleTime)

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- Cache ‡∏°‡∏µ `staleTime: 30 * 1000` (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- ‡∏ñ‡πâ‡∏≤ cache ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà stale ‚Üí ‡πÑ‡∏°‡πà refetch ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ cache ‡∏à‡∏∞ stale
- ‡∏ñ‡πâ‡∏≤ cache stale ‡πÅ‡∏•‡πâ‡∏ß ‚Üí refetch ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö network)

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÉ‡∏´‡∏°‡πà)

**‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:** 0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)

**‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏ï‡∏±‡πâ‡∏á `staleTime: 0` ‚Üí cache ‡∏à‡∏∞ stale ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÉ‡∏ä‡πâ `invalidateQueries` ‚Üí ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡∏ï‡∏±‡πâ‡∏á `refetchOnMount: true` ‚Üí refetch ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component mount

---

## üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

### 1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Save)

```
‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"
    ‚Üì
Frontend: ‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend (PUT /api/monthly-tax-data/:id)
    ‚Üì
Backend: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    ‚Üì
Backend: ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß
    ‚Üì
Frontend: onSuccess handler ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
```

### 2. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Cache ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Instant Update)

```typescript
// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó cache ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å backend response
queryClient.setQueryData(['monthly-tax-data', buildId, year, month], updatedData)

// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó list cache ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
queryClient.setQueriesData(
  { queryKey: ['monthly-tax-data', 'tax-status'], exact: false },
  (oldData) => {
    return {
      ...oldData,
      data: oldData.data.map(item => 
        item.id === updatedData.id ? updatedItemWithStatus : item
      )
    }
  }
)
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ network request

### 3. Invalidate ‡πÅ‡∏•‡∏∞ Refetch (Background Update)

```typescript
// Invalidate cache ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ refetch
queryClient.invalidateQueries(
  { queryKey: ['monthly-tax-data', 'tax-status'], exact: false },
  { refetchType: 'active' }
)

// Refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ staleTime)
queryClient.refetchQueries({ queryKey: ['monthly-tax-data', 'tax-status'], exact: false })
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å server (0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) - ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

---

## üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö

| ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô | ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç | ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç |
|---------|-----------|-----------|
| **‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Cache ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ** | ‚úÖ (0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) | ‚úÖ (0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) |
| **Refetch ‡∏à‡∏≤‡∏Å Server** | ‚ùå (‡∏£‡∏≠ staleTime 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) | ‚úÖ (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) |
| **‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** | 0-30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | 0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

---

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß

### 1. TaxInspectionForm.tsx

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```typescript
// ‡πÅ‡∏Ñ‡πà refetch (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà refetch ‡∏ñ‡πâ‡∏≤ cache ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà stale)
queryClient.refetchQueries({ queryKey: listKey, exact: false })
```

**‡πÄ‡∏õ‡πá‡∏ô:**
```typescript
// Invalidate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
queryClient.invalidateQueries(
  { queryKey: listKey, exact: false },
  { refetchType: 'active' }
)
// Refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
queryClient.refetchQueries({ queryKey: listKey, exact: false })
```

### 2. TaxStatusTable.tsx

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```typescript
staleTime: 30 * 1000, // Cache 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
```

**‡πÄ‡∏õ‡πá‡∏ô:**
```typescript
staleTime: 0, // Cache ‡∏à‡∏∞ stale ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
refetchOnMount: true, // Refetch ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component mount
```

### 3. TaxFilingTable.tsx

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```typescript
staleTime: 30 * 1000, // Cache 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
refetchOnMount: false, // ‡πÑ‡∏°‡πà refetch ‡πÄ‡∏°‡∏∑‡πà‡∏≠ mount
```

**‡πÄ‡∏õ‡πá‡∏ô:**
```typescript
staleTime: 0, // Cache ‡∏à‡∏∞ stale ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
refetchOnMount: true, // Refetch ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component mount
```

---

## üéØ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- Cache ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å backend response
- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ network)

### ‚úÖ Refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- Invalidate cache ‚Üí ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ refetch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å server ‚Üí ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ staleTime
- ‡∏ï‡∏±‡πâ‡∏á `staleTime: 0` ‚Üí cache ‡∏à‡∏∞ stale ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

---

## ‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

1. **Cache Update (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)**: 
   - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó cache ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å backend response
   - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
   - **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ network request**

2. **Refetch (0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)**:
   - Invalidate cache ‚Üí ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ refetch
   - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å server
   - **‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**

3. **staleTime = 0**:
   - Cache ‡∏à‡∏∞ stale ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
   - **‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ cache ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ (‡πÑ‡∏°‡πà refetch ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)**

---

## üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô Browser Console
```javascript
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô:
[TaxInspectionForm] Invalidate and refetch list for sourcePage taxStatus ['monthly-tax-data', 'tax-status']
[TaxInspectionForm] ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö { refetchTriggered: 'taxStatus', ... }
```

### 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô Network Tab
- ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `/api/monthly-tax-data?page=1&limit=20&...` ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
- Response time: 0.5-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö network)

### 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô React DevTools
- Query cache ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- Component ‡∏à‡∏∞ re-render ‡πÄ‡∏°‡∏∑‡πà‡∏≠ cache ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó

---

## üìö ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

- `src/components/TaxInspection/TaxInspectionForm.tsx` - ‡πÄ‡∏û‡∏¥‡πà‡∏° invalidateQueries
- `src/components/TaxStatus/TaxStatusTable.tsx` - ‡∏ï‡∏±‡πâ‡∏á staleTime = 0, refetchOnMount = true
- `src/components/TaxFiling/TaxFilingTable.tsx` - ‡∏ï‡∏±‡πâ‡∏á staleTime = 0, refetchOnMount = true
