# ğŸ“ à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¹€à¸à¹‡à¸šà¸ªà¸–à¸²à¸™à¸° à¸ .à¸.30 (pp30_status) - à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¹€à¸¥à¸·à¸­à¸à¸ˆà¸™à¸–à¸¶à¸‡à¸šà¸±à¸™à¸—à¸¶à¸

## ğŸ¯ à¸ªà¸£à¸¸à¸›

à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸™ Select "à¸ªà¸–à¸²à¸™à¸° à¸ .à¸.30" à¹ƒà¸™à¸Ÿà¸­à¸£à¹Œà¸¡à¸ªà¸–à¸²à¸™à¸°à¸ à¸²à¸©à¸µà¸›à¸£à¸°à¸ˆà¸³à¹€à¸”à¸·à¸­à¸™ (à¹à¸–à¸š VAT/debtor) à¸„à¹ˆà¸²à¸ˆà¸°à¸–à¸¹à¸à¹€à¸à¹‡à¸šà¹à¸¥à¸°à¸ªà¹ˆà¸‡à¹„à¸›à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸šà¸™à¸µà¹‰:

```
[Select onChange] â†’ [React State] â†’ [handleSave] â†’ [API Request] â†’ [Backend] â†’ [Database Columns]
```

---

## 1. Frontend - à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸° (Select onChange)

| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-------------|
| **à¹„à¸Ÿà¸¥à¹Œ** | `src/components/TaxInspection/TaxInspectionForm.tsx` |
| **à¸šà¸£à¸£à¸—à¸±à¸”** | ~3173-3181 |
| **Component** | `<Select>` à¸ªà¸³à¸«à¸£à¸±à¸š "à¸ªà¸–à¸²à¸™à¸° à¸ .à¸.30 *" (à¹à¸–à¸š VAT/debtor) |
| **onChange Handler** | ```tsx
onChange={(value) => {
  const newStatus = value || ''
  setFormValues((prev) => ({ ...prev, pp30_status: newStatus }))
  // Clear vatFilingReply à¸–à¹‰à¸²à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ 'paid'
  if (newStatus !== 'paid' && vatFilingReply.trim() !== '') {
    setVatFilingReply('')
  }
}}
``` |

**à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸à¹‡à¸š:**
- **State:** `formValues.pp30_status` (React state)
- **à¸„à¹ˆà¸²:** à¹€à¸Šà¹ˆà¸™ `'paid'`, `'sent_to_customer'`, `'pending_recheck'`, `'draft_completed'` à¸¯à¸¥à¸¯
- **Type:** `string | null`

---

## 2. Frontend - à¹€à¸¡à¸·à¹ˆà¸­à¸à¸”à¸šà¸±à¸™à¸—à¸¶à¸ (handleSave)

| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-------------|
| **à¹„à¸Ÿà¸¥à¹Œ** | `src/components/TaxInspection/TaxInspectionForm.tsx` |
| **à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™** | `handleSave()` (à¸šà¸£à¸£à¸—à¸±à¸” ~827) |
| **à¸à¸²à¸£à¸ªà¹ˆà¸‡** | à¸ªà¸£à¹‰à¸²à¸‡ `updateData` object à¹à¸¥à¹‰à¸§à¹€à¸£à¸µà¸¢à¸ `updateMutation.mutate(updateData)` |

**à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¹„à¸› API:**
```typescript
const currentPp30Status = formValues.pp30_status || '' // à¸­à¹ˆà¸²à¸™à¸ˆà¸²à¸ state

const updateData = {
  // ... fields à¸­à¸·à¹ˆà¸™à¹†
  pp30_status: currentPp30Status || null, // à¸ªà¹ˆà¸‡à¹„à¸› backend
  // ... fields à¸­à¸·à¹ˆà¸™à¹†
}

updateMutation.mutate(updateData)
```

**API à¸—à¸µà¹ˆà¹€à¸£à¸µà¸¢à¸:**
- **Method:** `PUT`
- **URL:** `/api/monthly-tax-data/{id}`
- **Service:** `monthlyTaxDataService.update(taxData.id, updateData)`

---

## 3. Backend - à¸£à¸±à¸šà¹à¸¥à¸°à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸²

| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-------------|
| **à¹„à¸Ÿà¸¥à¹Œ** | `backend/routes/monthly-tax-data.js` |
| **Endpoint** | `PUT /api/monthly-tax-data/:id` (à¸šà¸£à¸£à¸—à¸±à¸” ~1514) |
| **à¸£à¸±à¸šà¸„à¹ˆà¸²** | `pp30_status` à¸ˆà¸²à¸ `req.body` |

**à¸à¸²à¸£à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸² (à¸šà¸£à¸£à¸—à¸±à¸” ~1597-1625):**

Backend à¸ˆà¸°à¹à¸›à¸¥à¸‡ `pp30_status` à¹€à¸›à¹‡à¸™ timestamp fields à¸—à¸µà¹ˆà¹€à¸à¹‡à¸šà¹ƒà¸™ DB:

```javascript
switch (pp30_status) {
  case 'sent_to_customer':
    // Set pp30_sent_to_customer_date = à¹€à¸§à¸¥à¸²à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
    computedPp30SentToCustomerDate = now
    break
    
  case 'draft_completed':
    // Set vat_draft_completed_date = à¹€à¸§à¸¥à¸²à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
    computedVatDraftCompletedDate = now
    break
    
  case 'paid':
    // Set pp30_filing_response = 'paid' (à¸«à¸£à¸·à¸­à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¸¡à¸²)
    // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡ reply à¸¡à¸² â†’ computedPp30FilingResponse = 'paid'
    break
}
```

**à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸:** `pp30_status` à¹„à¸¡à¹ˆà¸¡à¸µ column à¹ƒà¸™ DB â€” à¹ƒà¸Šà¹‰à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸šà¸„à¸¸à¸¡ logic à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™

---

## 4. Database - à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹€à¸à¹‡à¸šà¸ˆà¸£à¸´à¸‡

| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-------------|
| **à¸•à¸²à¸£à¸²à¸‡** | `monthly_tax_data` |
| **Query** | `UPDATE monthly_tax_data SET ... WHERE id = ?` |

**à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸–à¸¹à¸à¸­à¸±à¸›à¹€à¸”à¸•à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°:**

| à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸ | à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸–à¸¹à¸à¸­à¸±à¸›à¹€à¸”à¸• | à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸à¹‡à¸š |
|---------------|---------------------|-----------|
| `'paid'` (à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§) | `pp30_filing_response` | `'paid'` (à¸«à¸£à¸·à¸­à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸à¸£à¸­à¸) |
| `'sent_to_customer'` (à¸ªà¹ˆà¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§) | `pp30_sent_to_customer_date` | `'2026-02-03 14:54:14'` (timestamp) |
| `'draft_completed'` (à¸£à¹ˆà¸²à¸‡à¹à¸šà¸šà¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§) | `vat_draft_completed_date` | `'2026-02-03 13:41:42'` (timestamp) |
| `'pending_review'` (à¸£à¸­à¸•à¸£à¸§à¸ˆ) | `pp30_sent_for_review_date` | `'2026-02-03 ...'` (timestamp) |
| `'pending_recheck'` (à¸£à¸­à¸•à¸£à¸§à¸ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡) | `pp30_review_returned_date` | `'2026-02-03 11:46:10'` (timestamp) |

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:**
- à¹€à¸¥à¸·à¸­à¸ **"à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§"** â†’ `pp30_filing_response = 'paid'`
- à¹€à¸¥à¸·à¸­à¸ **"à¸ªà¹ˆà¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§"** â†’ `pp30_sent_to_customer_date = '2026-02-03 14:54:14'`
- à¹€à¸¥à¸·à¸­à¸ **"à¸£à¹ˆà¸²à¸‡à¹à¸šà¸šà¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§"** â†’ `vat_draft_completed_date = '2026-02-03 13:41:42'`

---

## 5. à¸à¸²à¸£à¸­à¹ˆà¸²à¸™à¸à¸¥à¸±à¸šà¸¡à¸²à¹à¸ªà¸”à¸‡ (GET)

à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¸´à¸”à¸Ÿà¸­à¸£à¹Œà¸¡à¸«à¸£à¸·à¸­à¹‚à¸«à¸¥à¸” list à¹ƒà¸«à¸¡à¹ˆ:

1. **Backend:** SELECT à¸ˆà¸²à¸ `monthly_tax_data` â†’ à¹„à¸¡à¹ˆà¸¡à¸µ `pp30_status` column
2. **Backend Helper:** `derivePp30StatusFromRow(row)` â†’ derive à¸ˆà¸²à¸:
   - à¸–à¹‰à¸²à¸¡à¸µ `pp30_filing_response` â†’ `'paid'`
   - à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ â†’ à¹ƒà¸Šà¹‰ timestamp à¸¥à¹ˆà¸²à¸ªà¸¸à¸” â†’ `'sent_to_customer'` / `'pending_recheck'` / `'draft_completed'`
3. **Backend Response:** à¹€à¸à¸´à¹ˆà¸¡ `pp30_status` à¹ƒà¸™ response object
4. **Frontend:** à¹ƒà¸Šà¹‰ `derivePp30Status(data)` à¹€à¸à¸·à¹ˆà¸­à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡/à¸Ÿà¸­à¸£à¹Œà¸¡

---

## ğŸ“Š à¸ªà¸£à¸¸à¸›à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸™ Select "à¸ªà¸–à¸²à¸™à¸° à¸ .à¸.30"                â”‚
â”‚    â†“                                                         â”‚
â”‚    onChange â†’ setFormValues({ pp30_status: 'paid' })        â”‚
â”‚    â†“                                                         â”‚
â”‚    [à¹€à¸à¹‡à¸šà¹ƒà¸™ React State: formValues.pp30_status]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"                                     â”‚
â”‚    â†“                                                         â”‚
â”‚    handleSave() â†’ updateData = { pp30_status: 'paid' }     â”‚
â”‚    â†“                                                         â”‚
â”‚    PUT /api/monthly-tax-data/{id}                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend à¸£à¸±à¸šà¹à¸¥à¸°à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸²                                     â”‚
â”‚    â†“                                                         â”‚
â”‚    pp30_status = 'paid'                                     â”‚
â”‚    â†“                                                         â”‚
â”‚    computedPp30FilingResponse = 'paid'                      â”‚
â”‚    â†“                                                         â”‚
â”‚    UPDATE monthly_tax_data SET                              â”‚
â”‚      pp30_filing_response = 'paid'                          â”‚
â”‚      WHERE id = ?                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Database - à¸•à¸²à¸£à¸²à¸‡ monthly_tax_data                         â”‚
â”‚    â†“                                                         â”‚
â”‚    Column: pp30_filing_response = 'paid'                    â”‚
â”‚    (à¹„à¸¡à¹ˆà¸¡à¸µ column pp30_status - à¹ƒà¸Šà¹‰ derive à¸ˆà¸²à¸ fields à¸­à¸·à¹ˆà¸™)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” à¸§à¸´à¸˜à¸µà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹€à¸à¹‡à¸šà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

### 1. à¹€à¸Šà¹‡à¸„ React State (Frontend DevTools)
- à¹€à¸›à¸´à¸” React DevTools â†’ Components â†’ TaxInspectionForm
- à¸”à¸¹ `formValues.pp30_status` à¸§à¹ˆà¸²à¸¡à¸µà¸„à¹ˆà¸²à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

### 2. à¹€à¸Šà¹‡à¸„ Network Request (Browser DevTools)
- à¹€à¸›à¸´à¸” Network tab â†’ à¸à¸”à¸šà¸±à¸™à¸—à¸¶à¸
- à¸”à¸¹ `PUT /api/monthly-tax-data/{id}` â†’ Request Payload
- à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸² `pp30_status` à¸¡à¸µà¸„à¹ˆà¸²à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

### 3. à¹€à¸Šà¹‡à¸„ Backend Log
- à¸”à¸¹ Backend Terminal â†’ `ğŸ’¾ [Backend] Executing UPDATE query`
- à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸² `pp30_status` à¹à¸¥à¸° `pp30_filing_response` à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

### 4. à¹€à¸Šà¹‡à¸„ Database
```sql
SELECT id, build, pp30_filing_response, pp30_sent_to_customer_date, 
       vat_draft_completed_date, pp30_sent_for_review_date, 
       pp30_review_returned_date, updated_at
FROM monthly_tax_data 
WHERE build = '018'
ORDER BY updated_at DESC 
LIMIT 1;
```
- à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸² column à¸—à¸µà¹ˆà¸„à¸§à¸£à¸¡à¸µà¸„à¹ˆà¸²à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸¡à¸µà¸„à¹ˆà¸²à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
- à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸² `updated_at` à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¹€à¸§à¸¥à¸²à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

---

## âš ï¸ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸ªà¸³à¸„à¸±à¸

1. **à¹„à¸¡à¹ˆà¸¡à¸µ column `pp30_status` à¹ƒà¸™ DB** â€” à¹ƒà¸Šà¹‰ derive à¸ˆà¸²à¸ `pp30_filing_response` à¹à¸¥à¸° timestamp fields
2. **à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸ "à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§"** â†’ Backend à¸ˆà¸°à¸•à¸±à¹‰à¸‡ `pp30_filing_response = 'paid'` (à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡ reply à¸¡à¸²)
3. **à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸°à¸­à¸·à¹ˆà¸™** â†’ Backend à¸ˆà¸°à¸•à¸±à¹‰à¸‡ timestamp à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡ (à¹€à¸Šà¹ˆà¸™ `pp30_sent_to_customer_date` à¸ªà¸³à¸«à¸£à¸±à¸š "à¸ªà¹ˆà¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§")
4. **Backend response** à¸ˆà¸°à¸¡à¸µ `pp30_status` à¸—à¸µà¹ˆ derive à¸¡à¸²à¹ƒà¸«à¹‰ frontend à¹ƒà¸Šà¹‰à¹à¸ªà¸”à¸‡à¸œà¸¥
